<!DOCTYPE html><html lang="[&quot;zh-CN&quot;,&quot;default&quot;]"><head><meta name="generator" content="Hexo 3.9.0"><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>Go Micro框架(v2.9.1)的使用 | Pure Life</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=1.0.0"><link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/npm/normalize.css/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/npm/purecss/build/pure-min.min.css"><link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/npm/purecss/build/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.jsdelivr.net/npm/jquery/dist/jquery.min.js"></script><link rel="icon" mask="" sizes="any" href="/favicon.ico"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml"><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = 'https://hm.baidu.com/hm.js?' + 'e155b64355fa51e2e8a4ca9edc59e825';
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(hm, s);
  })();
</script><script type="text/javascript" src="//cdn.jsdelivr.net/npm/clipboard/dist/clipboard.min.js"></script><script type="text/javascript" src="//cdn.jsdelivr.net/gh/codeseven/toastr/build/toastr.min.js"></script><link rel="stylesheet" href="//cdn.jsdelivr.net/gh/codeseven/toastr/build/toastr.min.css"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">Go Micro框架(v2.9.1)的使用</h1><a id="logo" href="/.">Pure Life</a><p class="description">一亩三分路漫漫</p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/atom.xml"><i class="fa fa-rss"> 订阅</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">Go Micro框架(v2.9.1)的使用</h1><div class="post-meta">2020-10-20<span> | </span><span class="category"><a href="/categories/编程技术/">编程技术</a></span></div><div class="clear"><div class="toc-article" id="toc"><div class="toc-title">文章目录</div><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#null"><span class="toc-number">1.</span> <span class="toc-text">部署开发环境</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#null"><span class="toc-number">2.</span> <span class="toc-text">Micro Handler介绍</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#null"><span class="toc-number">3.</span> <span class="toc-text">Micro代理启动</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#null"><span class="toc-number">3.1.</span> <span class="toc-text">启动api网关</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#null"><span class="toc-number">3.2.</span> <span class="toc-text">设置命名空间</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#null"><span class="toc-number">3.3.</span> <span class="toc-text">设置服务发现</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#null"><span class="toc-number">3.4.</span> <span class="toc-text">RPC使用网关访问</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#null"><span class="toc-number">3.5.</span> <span class="toc-text">PROTO文件兼容其他tag</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#null"><span class="toc-number">4.</span> <span class="toc-text">使用Apollo配置中心</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#null"><span class="toc-number">5.</span> <span class="toc-text">OpenTrace设置</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#null"><span class="toc-number">6.</span> <span class="toc-text">Web设置Prometheus监控</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#null"><span class="toc-number">7.</span> <span class="toc-text">获取其他服务的信息</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#null"><span class="toc-number">8.</span> <span class="toc-text">教程中的问题：</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#null"><span class="toc-number">8.1.</span> <span class="toc-text">一、版本更迭，web handler无法使用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#null"><span class="toc-number">8.2.</span> <span class="toc-text">Web HTTP代理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#null"><span class="toc-number">8.3.</span> <span class="toc-text">二、Trace部分HTTP2Micro无法使用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#null"><span class="toc-number">8.4.</span> <span class="toc-text">三、设置Prometheus监控</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#null"><span class="toc-number">9.</span> <span class="toc-text">组件环境</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#null"><span class="toc-number">10.</span> <span class="toc-text">Web和Srv的区别</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#null"><span class="toc-number">11.</span> <span class="toc-text">学习资料</span></a></li></ol></div></div><div class="post-content"><h2><span id="部署开发环境">部署开发环境</span></h2>
<ul>
<li>Golang环境 <a href="https://golang.google.cn/" target="_blank" rel="noopener">安装</a></li>
<li>gRPC <a href="https://grpc.io/docs/quickstart/go.html" target="_blank" rel="noopener">安装</a></li>
<li>Micro</li>
</ul>
<p>Micro目前V3版本未稳定，使用V2版本进行学习和开发使用。</p>
<blockquote>
<p><s>Micro已经出了V3版本，不过最近asim发言称，V3是最后一个版本了，Micro也不属于Micro团队维护项目了，它将回归于个人项目。</s></p>
<p><s>以前的go-micro版本：</s></p>
<p><s><a href="https://github.com/microhq/go-micro" target="_blank" rel="noopener">https://github.com/microhq/go-micro</a></s></p>
<p><s><a href="https://github.com/microhq/go-plugins" target="_blank" rel="noopener">https://github.com/microhq/go-plugins</a></s></p>
<p><s><a href="https://github.com/microhq/protoc-gen-micro" target="_blank" rel="noopener">https://github.com/microhq/protoc-gen-micro</a></s></p>
<p>现在的消息，go-micro已经回到asim个人仓库，但其已经把开源项目的<a href="https://micro-services.slack.com/archives/C01C1UP8USX/p1622128782149200" target="_blank" rel="noopener">issue都关闭了</a>（2021/5/27），只接受PR，且不会有maintainer的支持。因为他觉得Github上的人只是去抱怨，而不去解决问题。然后他就把解决问题的人给解决了，这波操作在大气层。说实话，我觉得他真的太能折腾了，这个框架实在不建议使用了，maintainer想法太多了，有点伤。</p>
<p>有替代品吗？有的，而且就是国内的，工程性都做的比较好，推荐两个，<a href="https://github.com/go-kratos/kratos" target="_blank" rel="noopener">go-kratos</a>，<a href="https://github.com/tal-tech/go-zero" target="_blank" rel="noopener">go-zero</a>。<a href="https://github.com/tal-tech/go-zero" target="_blank" rel="noopener">go-zero</a>听说是要进入CNCF基金会了。<a href="https://github.com/go-kratos/kratos" target="_blank" rel="noopener">go-kratos</a>在腾讯的一些业务上有用到。</p>
</blockquote>
<a id="more"></a>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">## 安装go-micro</span><br><span class="line">go get github.com/micro/go-micro/v2</span><br><span class="line"></span><br><span class="line">## 安装micro</span><br><span class="line">go get github.com/micro/micro/v2</span><br><span class="line"></span><br><span class="line">download protobuf for micro:</span><br><span class="line">go get -u github.com/golang/protobuf/proto</span><br><span class="line">go get -u github.com/golang/protobuf/protoc-gen-go</span><br><span class="line">go get github.com/micro/micro/v2/cmd/protoc-gen-micro</span><br></pre></td></tr></table></figure>
<blockquote>
<p>常见开发组件如何一键安装，使用docker进行环境部署，见<a href="#%E7%BB%84%E4%BB%B6%E7%8E%AF%E5%A2%83">组件环境</a>。</p>
</blockquote>
<p>查看Micro命令的Help，命令参数后跟上<code>--help</code>，例如：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">micro <span class="built_in">new</span> --help</span><br></pre></td></tr></table></figure>
<h2><span id="micro-handler介绍">Micro Handler介绍</span></h2>
<p>在micro的系统中，有许多资源类型，作为框架对服务的一种抽象归类，比如常用的有：api、fnc（函数）、srv、web。其中经常需要使用的是api、srv、web，<a href="https://github.com/micro-in-cn/questions/issues/15" target="_blank" rel="noopener">关于web，api，srv这三种服务的疑问</a>，可以查看该Issue。</p>
<p>例如，在实际使用中，我的理解是，简化分类，使用web，srv作为整体架构，web处理HTTP请求，srv提供特定的服务，例如，登录，验证，访问数据等操作。</p>
<p>web框架代码生成：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">micro new --namespace=mu.micro.book --type=web --alias=order micro_learn/orders-web</span><br></pre></td></tr></table></figure>
<p>service框架代码生成：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> micro new --namespace=mu.micro.book --<span class="built_in">type</span>=service --<span class="built_in">alias</span>=u12 user-test</span></span><br><span class="line">Creating service mu.micro.book.service.u12 in user-test</span><br><span class="line"></span><br><span class="line">.</span><br><span class="line">├── main.go</span><br><span class="line">├── generate.go</span><br><span class="line">├── plugin.go</span><br><span class="line">├── handler</span><br><span class="line">│   └── u12.go</span><br><span class="line">├── subscriber</span><br><span class="line">│   └── u12.go</span><br><span class="line">├── proto</span><br><span class="line">│   └── u12</span><br><span class="line">│       └── u12.proto</span><br><span class="line">├── Dockerfile</span><br><span class="line">├── Makefile</span><br><span class="line">├── README.md</span><br><span class="line">├── .gitignore</span><br><span class="line">└── go.mod</span><br></pre></td></tr></table></figure>
<p>删除subscriber目录，这是用于专门放订阅异步消息组件的目录，我们暂时用不到。</p>
<p>删除go mod文件，仅需要在项目最外层有统一的go mod。</p>
<p>删除Dockerfile, <a href="http://xn--MakefileREADME-de7vp6iwvx748dgzme53huewa.md" target="_blank" rel="noopener">Makefile打包编程文件与README.md</a>，可以选择性保留。</p>
<hr>
<blockquote>
<p><a href="#Web%E5%92%8CSrv%E7%9A%84%E5%8C%BA%E5%88%AB">Web和Srv的区别</a></p>
</blockquote>
<p>Micro Grpc代码生成：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">protoc --proto_path=. --go_out=. --micro_out=. u12.proto</span><br></pre></td></tr></table></figure>
<blockquote>
<p>这里有个小细节，生成代码时，如果想生成micro目录下的user服务，那就在micro的同级目录下，运行命令。</p>
<p>micro new --namespace=mu.micro.book --type=web --alias=order micro/user</p>
<p>这样生成，proto文件路径才不会出现路径问题。</p>
</blockquote>
<h2><span id="micro代理启动">Micro代理启动</span></h2>
<h3><span id="启动api网关">启动api网关</span></h3>
<p><code>micro api</code> 即可启动api一个网关,默认的端口是8080<br>
可以通过<code>--address=0.0.0.0:8080</code>flag或者设置环境<code>MICRO_API_ADDRESS=0.0.0.0:8080</code>来修改</p>
<h3><span id="设置命名空间">设置命名空间</span></h3>
<p><code>micro --api_namespace=namespace api</code>或<code>MICRO_API_NAMESPACE=namespace micro api</code><br>
注意启动api时设置的namespace必须与要访问的资源的namespace一致不然无法访问，Web管理控制台类似</p>
<h3><span id="设置服务发现">设置服务发现</span></h3>
<p>Micro默认是使用Grpc Mdns的方式进行局域网的服务发现，使用<code>--registry</code>参数修改注册服务，consul、etcd等，<code>micro --registry=etcd list services</code>。<code>--registry_address</code>修改默认ETCD注册地址。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">micro --registry=etcd --api_namespace=mu.micro.book.web api --handler=web</span><br></pre></td></tr></table></figure>
<h3><span id="rpc使用网关访问">RPC使用网关访问</span></h3>
<p><code>--enable_rpc</code>参数是<code>micro api</code>的参数，默认为false，这个得<strong>注意，注意，再注意</strong>，因为看到网上很多教程没有提到要开启，显然是Micro更新过快的锅。。。。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">micro_v2.exe --registry=etcd api --enable_rpc</span><br></pre></td></tr></table></figure>
<p>接下来就是访问了。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">curl --location --request POST 'http://localhost:8080/rpc' \</span><br><span class="line">--header 'Content-Type: application/json' \</span><br><span class="line">--data-raw '&#123;</span><br><span class="line">    "service": "micro.xxx.service.process_route",</span><br><span class="line">    "method": "ProcessRoute.StoreProcessInfo",</span><br><span class="line">    "request": &#123;</span><br><span class="line">        "xxxx": "xxx",</span><br><span class="line">        "xxx": "xxx",</span><br><span class="line">    &#125;</span><br><span class="line">&#125;'</span><br></pre></td></tr></table></figure>
<p><code>service</code>和<code>method</code>如何去确定，若没有经验的情况下，可以使用我的办法：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">micro --registry=etcd api --enable_rpc</span><br><span class="line"></span><br><span class="line">./etcdctl get "" --prefix</span><br></pre></td></tr></table></figure>
<p>随便找一个去看一下就好了。</p>
<h3><span id="proto文件兼容其他tag">PROTO文件兼容其他tag</span></h3>
<p>使用工具：<a href="https://github.com/favadi/protoc-go-inject-tag" target="_blank" rel="noopener">https://github.com/favadi/protoc-go-inject-tag</a> 。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">go get github.com/favadi/protoc-go-inject-tag</span><br></pre></td></tr></table></figure>
<p>Example:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">// file: test.proto</span><br><span class="line">syntax = &quot;proto3&quot;;</span><br><span class="line"></span><br><span class="line">package pb;</span><br><span class="line"></span><br><span class="line">message IP &#123;</span><br><span class="line">  // @inject_tag: valid:&quot;ip&quot;</span><br><span class="line">  string Address = 1;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Generate with protoc command as normal.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">protoc --go_out=. test.proto</span><br></pre></td></tr></table></figure>
<p>Run <code>protoc-go-inject-tag</code> with generated file <code>test.pb.go</code>.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">protoc-go-inject-tag -input=./test.pb.go</span><br></pre></td></tr></table></figure>
<p>The custom tags will be injected to <code>test.pb.go</code>.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">type IP struct &#123;</span><br><span class="line">	// @inject_tag: valid:&quot;ip&quot;</span><br><span class="line">	Address string `protobuf:&quot;bytes,1,opt,name=Address,json=address&quot; json:&quot;Address,omitempty&quot; valid:&quot;ip&quot;`</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2><span id="使用apollo配置中心">使用Apollo配置中心</span></h2>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	apollo <span class="string">"github.com/xxxmicro/go-micro-apollo-plugin"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">	e := json.NewEncoder()</span><br><span class="line">	<span class="keyword">if</span> err := config.Load(apollo.NewSource(</span><br><span class="line">		apollo.WithAddress(<span class="string">"172.16.9.229"</span>+<span class="string">":8080"</span>),</span><br><span class="line">		apollo.WithNamespace(<span class="string">"application"</span>),</span><br><span class="line">		apollo.WithAppId(<span class="string">"12345"</span>),</span><br><span class="line">		apollo.WithCluster(<span class="string">"dev"</span>),</span><br><span class="line">		source.WithEncoder(e),</span><br><span class="line">	)); err != <span class="literal">nil</span> &#123;</span><br><span class="line">		log.Error(err)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> err := config.Get(<span class="string">"etcd"</span>).Scan(&amp;etcdConfig); err != <span class="literal">nil</span> &#123;</span><br><span class="line">		log.Error(err)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> err := config.Get(<span class="string">"mysql"</span>).Scan(&amp;mysqlConfig); err != <span class="literal">nil</span> &#123;</span><br><span class="line">		log.Error(err)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> err := config.Get(<span class="string">"redis"</span>).Scan(&amp;redisConfig); err != <span class="literal">nil</span> &#123;</span><br><span class="line">		log.Error(err)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> err := config.Get(<span class="string">"zap"</span>).Scan(&amp;zapConfig); err != <span class="literal">nil</span> &#123;</span><br><span class="line">		log.Error(err)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> err := config.Get(<span class="string">"jwt"</span>).Scan(&amp;jwtConfig); err != <span class="literal">nil</span> &#123;</span><br><span class="line">		log.Error(err)</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>
<h2><span id="opentrace设置">OpenTrace设置</span></h2>
<p>Trace ID 在入口函数设置后，后续均一样。Span ID则标识每一个服务实例。</p>
<p>其他服务，可通过此操作，从context中拿到trace，拿到后，可以使用Log，将一些信息打印到trace上。</p>
<p>Web端：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">	<span class="comment">// 分布式追踪链路</span></span><br><span class="line">	t, io, err := tracer.NewTracer(<span class="string">"mu.micro.book.web.api.user"</span>, <span class="string">""</span>)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		log.Fatal(err.Error())</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">defer</span> io.Close()</span><br><span class="line">	opentracing.SetGlobalTracer(t)</span><br><span class="line"></span><br><span class="line">	.......</span><br><span class="line"></span><br><span class="line">	<span class="comment">//设置采样率</span></span><br><span class="line">	gin2micro.SetSamplingFrequency(<span class="number">50</span>)</span><br><span class="line">	router := gin.Default()</span><br><span class="line">	r := router.Group(<span class="string">"/user"</span>)</span><br><span class="line"></span><br><span class="line">	<span class="comment">//添加Tracer中间件</span></span><br><span class="line">	r.Use(gin2micro.TracerWrapper)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Login</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">	ctx, ok := gin2micro.ContextWithSpan(c)</span><br><span class="line">	<span class="keyword">if</span> ok == <span class="literal">false</span> &#123;</span><br><span class="line">		log.Error(<span class="string">"get context err"</span>)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	sp := opentracing.SpanFromContext(ctx)</span><br><span class="line">	<span class="comment">// Get request ID for context</span></span><br><span class="line">	<span class="keyword">if</span> sc, ok := sp.Context().(jaeger.SpanContext); ok &#123;</span><br><span class="line">		fmt.Println(sc.TraceID().String())</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	......</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 调用后台服务</span></span><br><span class="line">	rsp, err := userClient.QueryUserByName(ctx, &amp;us.Request&#123;</span><br><span class="line">		UserName: c.Request.Form.Get(<span class="string">"userName"</span>),</span><br><span class="line">	&#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Service端：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"github.com/opentracing/opentracing-go"</span></span><br><span class="line">	tarceLog <span class="string">"github.com/opentracing/opentracing-go/log"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(e *Service)</span> <span class="title">QueryUserByName</span><span class="params">(ctx context.Context, req *s.Request, rsp *s.Response)</span> <span class="title">error</span></span> &#123;</span><br><span class="line"></span><br><span class="line">    sp := opentracing.SpanFromContext(ctx)</span><br><span class="line">    <span class="keyword">if</span> sc, ok := sp.Context().(jaeger.SpanContext); ok &#123;</span><br><span class="line">        fmt.Println(sc.TraceID().String(), sc)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    sp.LogFields(</span><br><span class="line">        tarceLog.String(<span class="string">"event"</span>, <span class="string">"soft error"</span>),</span><br><span class="line">        tarceLog.String(<span class="string">"type"</span>, <span class="string">"cache timeout"</span>),</span><br><span class="line">        tarceLog.Int(<span class="string">"waited.millis"</span>, <span class="number">1500</span>))</span><br><span class="line">	</span><br><span class="line">    .......</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2><span id="web设置prometheus监控">Web设置Prometheus监控</span></h2>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">promMonitor := monitor.NewPrometheusMonitor(<span class="string">"user_web"</span>, <span class="string">"user"</span>)</span><br><span class="line">r.Use(promMonitor.PromMiddleware())</span><br><span class="line"></span><br><span class="line">r.POST(<span class="string">"/login"</span>, handler.Login)</span><br><span class="line"></span><br><span class="line">router.GET(<span class="string">"/metrics"</span>, gin.WrapH(promhttp.Handler()))</span><br><span class="line"></span><br><span class="line">....</span><br></pre></td></tr></table></figure>
<h2><span id="获取其他服务的信息">获取其他服务的信息</span></h2>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">micReg registry.Registry</span><br><span class="line"></span><br><span class="line">services, err := micReg.GetService(appName)</span><br><span class="line">log.Info(services[<span class="number">0</span>].Version)</span><br><span class="line"></span><br><span class="line"><span class="comment">// level=info latest</span></span><br></pre></td></tr></table></figure>
<p><code>etcd.go</code>中：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">GetService(xxxxxxxxxxxxx)</span><br><span class="line">.....</span><br><span class="line">	rsp, err := e.client.Get(ctx, servicePath(name)+<span class="string">"/"</span>, clientv3.WithPrefix(), clientv3.WithSerializable())</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">nil</span>, err</span><br><span class="line">	&#125;</span><br><span class="line">........</span><br></pre></td></tr></table></figure>
<p><code>WithPrefix</code>，将会把传入的<code>name</code>作为前缀的key全部取下来，所以<code>GetService</code>才会返回的是一个数组。</p>
<p>另外，<code>ListServices</code>则是把服务信息全部返回。</p>
<p>Micro工具获取服务信息：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">micro.exe --registry=etcd --registry_address="192.xx.xx.xxx:2379" get service "xxxxxxxxxxxx"</span><br></pre></td></tr></table></figure>
<h2><span id="教程中的问题">教程中的问题：</span></h2>
<h3><span id="一-版本更迭web-handler无法使用">一、版本更迭，web handler无法使用</span></h3>
<p>造成问题，micro api，POST /user/login HTTP/1.1&quot; 500 0。问题是使用了最新的稳定版本micro。</p>
<p><s>micro 2.9.3没有<code>web</code> handler，开发组尚未解决。<a href="https://github.com/micro/go-micro/issues/1945" target="_blank" rel="noopener">issue</a>。</s>  不是没有了，看代码，其实是cmd中没有添加而已。</p>
<p>现在的解决方法就是，虽然使用<code>--type=web</code>创建项目：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">micro new --namespace=mu.micro.book --type=web --alias=user micro/user-web</span><br></pre></td></tr></table></figure>
<p>代码修改：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">默认</span><br><span class="line">web.Name(&quot;mu.micro.book.web.user&quot;)</span><br><span class="line"></span><br><span class="line">改为</span><br><span class="line">web.Name(&quot;mu.micro.book.web.api.user&quot;)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>注意，这里这个<code>api</code>是必须的，查看代码会发现api模式代理rpc、http、proxy、web等，默认创建的只有web，显然是V1版本时代的产物，这里可以修改生成代码器将其改掉。</p>
</blockquote>
<p>micro启动命令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">micro --registry=etcd --api_namespace=mu.micro.book.web api --handler=web</span><br></pre></td></tr></table></figure>
<blockquote>
<p>解决方法参考☞<a href="https://github.com/micro/micro/issues/944#issuecomment-646472062" target="_blank" rel="noopener">issue</a>。</p>
</blockquote>
<h3><span id="web-http代理">Web HTTP代理</span></h3>
<p><code>micro api --handler=web</code>。</p>
<blockquote>
<p>web handler是一个基于服务发现和web socket支持的http反向代理。</p>
<ul>
<li>Content-Type: Any</li>
<li>Body: Any</li>
<li>正向格式:HTTP反向代理，包括web sockets。</li>
<li>Path: <code>/[service]</code></li>
<li>解析器:路径用于解析服务名称。</li>
<li>配置:Flag <code>—handler=web</code> 或 <code>MICRO_API_HANDLER=web</code></li>
</ul>
</blockquote>
<p>上面这段需要怎么理解呢？</p>
<p>例如Service Name为<code>micro.cloud.api.test</code>。</p>
<p>启动micro进行代理：<code>micro_v2.exe --api_namespace=micro.cloud api --handler=web</code>.</p>
<p>此时，凡是<code>/test</code>前缀的HTTP请求，均从此服务请求，同理，此服务其他不是<code>/test</code>前缀，通过Micro则访问不到。</p>
<blockquote>
<p>此时这个service，不能是下划线形式，例如，test_one。</p>
</blockquote>
<h3><span id="二-trace部分http2micro无法使用">二、Trace部分HTTP2Micro无法使用</span></h3>
<p>按照原生HTTP方式注入Trace，没有能够完整使用，使用Gin或者Echo第三方Web库，利用其插件形式进行使用，则可以正常使用Trace服务。</p>
<h3><span id="三-设置prometheus监控">三、设置Prometheus监控</span></h3>
<p>需上文提到的方式，设置Gin框架的监控，按照网上操作，无法监视到接口访问。</p>
<h2><span id="组件环境">组件环境</span></h2>
<p>ETCD:</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -p <span class="number">2379</span>:<span class="number">2379</span> -p <span class="number">2380</span>:<span class="number">2380</span> --name etcd gcr.io/etcd-development/etcd:v3<span class="number">.4</span><span class="number">.13</span></span><br></pre></td></tr></table></figure>
<p>MySQL:</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker pull mysql</span><br><span class="line"></span><br><span class="line">docker run -itd --name mysql-test -p <span class="number">3306</span>:<span class="number">3306</span> -e MYSQL_ROOT_PASSWORD=<span class="number">123456</span> mysql</span><br></pre></td></tr></table></figure>
<p>Redis：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker pull redis:latest</span><br><span class="line"></span><br><span class="line">docker run -itd --name redis -p 6379:6379 redis</span><br></pre></td></tr></table></figure>
<p>Jaeger：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -d --name jaeger -e COLLECTOR_ZIPKIN_HTTP_PORT=9411 -p 5775:5775/udp -p 6831:6831/udp -p 6832:6832/udp -p 5778:5778 -p 16686:16686 -p 14268:14268 -p 9411:9411 jaegertracing/all-in-one:1.6</span><br></pre></td></tr></table></figure>
<p>Promethes</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">prometheus.yml</span><br><span class="line">global:</span><br><span class="line">  scrape_interval:     15s # By default, scrape targets every 15 seconds.</span><br><span class="line"></span><br><span class="line">  # Attach these labels to any time series or alerts when communicating with</span><br><span class="line">  # external systems (federation, remote storage, Alertmanager).</span><br><span class="line">  external_labels:</span><br><span class="line">    monitor: &apos;codelab-monitor&apos;</span><br><span class="line"></span><br><span class="line"># A scrape configuration containing exactly one endpoint to scrape:</span><br><span class="line"># Here it&apos;s Prometheus itself.</span><br><span class="line">scrape_configs:</span><br><span class="line">  # The job name is added as a label `job=&lt;job_name&gt;` to any timeseries scraped from this config.</span><br><span class="line">  - job_name: &apos;prometheus&apos;</span><br><span class="line">    # Override the global default and scrape targets from this job every 5 seconds.</span><br><span class="line">    scrape_interval: 5s</span><br><span class="line">    static_configs:</span><br><span class="line">      - targets: [&apos;10.2.43.4:8088&apos;]</span><br><span class="line"></span><br><span class="line">targets : 作为拉取数据的地址。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">docker run -d -p 9090:9090 -v C:/tmp/prometheus.yml:/etc/prometheus/prometheus.yml --name prometheus prom/prometheus</span><br></pre></td></tr></table></figure>
<p>Grafana</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -d -p 3000:3000 --name grafana grafana/grafana</span><br></pre></td></tr></table></figure>
<h2><span id="web和srv的区别">Web和Srv的区别</span></h2>
<blockquote>
<p><a href="https://github.com/micro-in-cn/questions/issues/45" target="_blank" rel="noopener">web.NewService 和 micro.NewService有啥区别</a></p>
<p>功能上：web打开的Http服务，micro打开的RPC/API服务<br>
联系：为了让web服务能像RPC/API一样融合到Micro的微服务体系中，web.Micro做了以下事情：</p>
<ol>
<li>与RPC一样注册服务</li>
<li>可以复用Service的配置，声明micro.client调用RPC</li>
<li>client为http.client，非micro.client，故而无法直接使用web.client调用micro.service</li>
<li>web的Transport并非micro.Transport，所以micro的RPC服务无法直接调用web.service，需要使用http.client调用。</li>
</ol>
<p>一句话总结：web面向http，可以向异构服务提供服务，rpc则是纯内部服务。</p>
</blockquote>
<h2><span id="学习资料">学习资料</span></h2>
<p><a href="https://github.com/micro-in-cn/tutorials" target="_blank" rel="noopener">Micro 中国站教程系列</a></p>
<p><a href="https://github.com/Allenxuxu/microservices" target="_blank" rel="noopener">microservices</a></p>
<p><a href="https://github.com/shumintao/sass-web-server" target="_blank" rel="noopener">sass-web-server</a></p>
<p><a href="https://juejin.cn/post/6844903780736057357" target="_blank" rel="noopener">牌类游戏使用微服务重构笔记（二）: micro框架简介:micro toolkit</a></p>
</div><div id="donate"><link rel="stylesheet" type="text/css" href="/css/donate.css"><script type="text/javascript" src="/js/donate.js" successtext="复制成功!"></script><a class="pos-f tr3" id="github" href="https://github.com/Kaiyuan/donate-page" arget="_blank" title="Github"></a><div id="DonateText">Donate</div><ul class="list pos-f" id="donateBox"><li id="PayPal"><a href="https://paypal.me/zanghong" target="_blank"></a></li><li id="AliPay" qr="/img/zhifubao.png"></li><li id="WeChat" qr="/img/weixin.png"></li></ul><div class="pos-f left-100" id="QRBox"><div id="MainBox"></div></div></div><div class="post-copyright"><script type="text/javascript" src="/js/copyright.js" successtext="复制成功!"></script><link rel="stylesheet" type="text/css" href="/css/copyright.css"><p><span>本文标题：</span>Go Micro框架(v2.9.1)的使用</p><p><span>文章作者：</span>小师</p><p><span>发布时间：</span>2020-10-20</p><p><span>最后更新：</span>2022-05-04</p><p><span>原始链接：</span><a href="/2020/10/20/Go-Micro框架的使用/">chunlife.top/2020/10/20/Go-Micro框架的使用/</a><span class="copy-path"><i class="fa fa-clipboard" data-clipboard-text="chunlife.top/2020/10/20/Go-Micro框架的使用/"></i></span></p><p><span>版权声明：</span>本站所有文章均采用知识共享署名4.0国际许可协议进行许可</p></div><br><div class="tags"><a href="/tags/Go-Micro/"><i class="fa fa-tag"></i>Go Micro</a><a href="/tags/微服务/"><i class="fa fa-tag"></i>微服务</a><a href="/tags/OpenTrace/"><i class="fa fa-tag"></i>OpenTrace</a><a href="/tags/Prometheus/"><i class="fa fa-tag"></i>Prometheus</a></div><div class="post-nav"><a class="pre" href="/2020/11/04/块设备在Linux上读写直接使用IO/">块设备在Linux上读写直接使用IO</a><a class="next" href="/2020/10/20/win10-Linux子系统使用docker/">win10 Linux子系统使用docker</a></div><div id="container"></div><link rel="stylesheet" type="text/css" href="//unpkg.com/gitalk/dist/gitalk.css?v=1.0.0"><script type="text/javascript" src="//cdn.bootcss.com/blueimp-md5/2.10.0/js/md5.js?v=1.0.0"></script><script type="text/javascript" src="//unpkg.com/gitalk/dist/gitalk.min.js?v=1.0.0"></script><script>var gitalk = new Gitalk({
  clientID: '01eb77bfd18de524243f',
  clientSecret: '8cb336d6c7ac88bcc0ffb29c496f7dafe5c082e3',
  repo: 'younglifestyle.github.io',
  owner: 'younglifestyle',
  admin: ['younglifestyle'],
  id: md5(location.pathname),
  distractionFreeMode: false
})
gitalk.render('container')
</script><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><ins class="adsbygoogle" style="display:block; text-align:center;" data-ad-client="ca-pub-2375091422289560" data-ad-slot="8776143066" data-ad-format="fluid" data-ad-layout="in-article" data-full-width-responsive="true"></ins><script>(adsbygoogle = window.adsbygoogle || []).push({});</script></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form class="search-form" action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank"><input type="text" name="q" maxlength="20" placeholder="Search"><input type="hidden" name="sitesearch" value="chunlife.top"></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/DB/">DB</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/devops/">devops</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/分布式服务/">分布式服务</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/杂项/">杂项</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/算法/">算法</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/系统/">系统</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/编程技术/">编程技术</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/高并发/" style="font-size: 15px;">高并发</a> <a href="/tags/6-824/" style="font-size: 15px;">6.824</a> <a href="/tags/MapReduce/" style="font-size: 15px;">MapReduce</a> <a href="/tags/分布式/" style="font-size: 15px;">分布式</a> <a href="/tags/MIT-6-824/" style="font-size: 15px;">MIT 6.824</a> <a href="/tags/论文/" style="font-size: 15px;">论文</a> <a href="/tags/幂等/" style="font-size: 15px;">幂等</a> <a href="/tags/Go/" style="font-size: 15px;">Go</a> <a href="/tags/Axure/" style="font-size: 15px;">Axure</a> <a href="/tags/微信和小程序/" style="font-size: 15px;">微信和小程序</a> <a href="/tags/iOS/" style="font-size: 15px;">iOS</a> <a href="/tags/macOS/" style="font-size: 15px;">macOS</a> <a href="/tags/Android/" style="font-size: 15px;">Android</a> <a href="/tags/Windows/" style="font-size: 15px;">Windows</a> <a href="/tags/CSDN/" style="font-size: 15px;">CSDN</a> <a href="/tags/Bigtable/" style="font-size: 15px;">Bigtable</a> <a href="/tags/结构化数据存储系统/" style="font-size: 15px;">结构化数据存储系统</a> <a href="/tags/随笔/" style="font-size: 15px;">随笔</a> <a href="/tags/bilibili源码/" style="font-size: 15px;">bilibili源码</a> <a href="/tags/bilibili-code/" style="font-size: 15px;">bilibili code</a> <a href="/tags/elasticsearch/" style="font-size: 15px;">elasticsearch</a> <a href="/tags/Gateway/" style="font-size: 15px;">Gateway</a> <a href="/tags/搭建博客/" style="font-size: 15px;">搭建博客</a> <a href="/tags/github-pages/" style="font-size: 15px;">github pages</a> <a href="/tags/coding-Pages/" style="font-size: 15px;">coding Pages</a> <a href="/tags/A-Scalable-Distributed-File-System/" style="font-size: 15px;">A Scalable Distributed File System</a> <a href="/tags/apidoc/" style="font-size: 15px;">apidoc</a> <a href="/tags/go/" style="font-size: 15px;">go</a> <a href="/tags/Goroutine/" style="font-size: 15px;">Goroutine</a> <a href="/tags/Go-Micro/" style="font-size: 15px;">Go Micro</a> <a href="/tags/调试/" style="font-size: 15px;">调试</a> <a href="/tags/pprof/" style="font-size: 15px;">pprof</a> <a href="/tags/performance/" style="font-size: 15px;">performance</a> <a href="/tags/性能/" style="font-size: 15px;">性能</a> <a href="/tags/go-mod/" style="font-size: 15px;">go mod</a> <a href="/tags/微服务/" style="font-size: 15px;">微服务</a> <a href="/tags/OpenTrace/" style="font-size: 15px;">OpenTrace</a> <a href="/tags/Prometheus/" style="font-size: 15px;">Prometheus</a> <a href="/tags/context/" style="font-size: 15px;">context</a> <a href="/tags/gin/" style="font-size: 15px;">gin</a> <a href="/tags/go-test/" style="font-size: 15px;">go test</a> <a href="/tags/httptest/" style="font-size: 15px;">httptest</a> <a href="/tags/oracle/" style="font-size: 15px;">oracle</a> <a href="/tags/plugin/" style="font-size: 15px;">plugin</a> <a href="/tags/Google/" style="font-size: 15px;">Google</a> <a href="/tags/lantern/" style="font-size: 15px;">lantern</a> <a href="/tags/chromium-谷歌访问助手/" style="font-size: 15px;">chromium 谷歌访问助手</a> <a href="/tags/nil-compare-interface/" style="font-size: 15px;">nil compare interface</a> <a href="/tags/Google-MapReduce/" style="font-size: 15px;">Google MapReduce</a> <a href="/tags/Shell/" style="font-size: 15px;">Shell</a> <a href="/tags/exec/" style="font-size: 15px;">exec</a> <a href="/tags/goroutine/" style="font-size: 15px;">goroutine</a> <a href="/tags/fanout/" style="font-size: 15px;">fanout</a> <a href="/tags/fanin/" style="font-size: 15px;">fanin</a> <a href="/tags/基础/" style="font-size: 15px;">基础</a> <a href="/tags/读写文件/" style="font-size: 15px;">读写文件</a> <a href="/tags/Goland/" style="font-size: 15px;">Goland</a> <a href="/tags/GRPC/" style="font-size: 15px;">GRPC</a> <a href="/tags/Jetbrains/" style="font-size: 15px;">Jetbrains</a> <a href="/tags/singleflight/" style="font-size: 15px;">singleflight</a> <a href="/tags/cache/" style="font-size: 15px;">cache</a> <a href="/tags/Freescale/" style="font-size: 15px;">Freescale</a> <a href="/tags/C语言/" style="font-size: 15px;">C语言</a> <a href="/tags/后台运行/" style="font-size: 15px;">后台运行</a> <a href="/tags/nohub/" style="font-size: 15px;">nohub</a> <a href="/tags/Linux/" style="font-size: 15px;">Linux</a> <a href="/tags/文件共享-邮件/" style="font-size: 15px;">文件共享_邮件</a> <a href="/tags/markdown/" style="font-size: 15px;">markdown</a> <a href="/tags/Leaf/" style="font-size: 15px;">Leaf</a> <a href="/tags/mongoDB/" style="font-size: 15px;">mongoDB</a> <a href="/tags/MySQL/" style="font-size: 15px;">MySQL</a> <a href="/tags/事务/" style="font-size: 15px;">事务</a> <a href="/tags/MVCC/" style="font-size: 15px;">MVCC</a> <a href="/tags/mysql/" style="font-size: 15px;">mysql</a> <a href="/tags/explain/" style="font-size: 15px;">explain</a> <a href="/tags/Gorm/" style="font-size: 15px;">Gorm</a> <a href="/tags/json/" style="font-size: 15px;">json</a> <a href="/tags/存储/" style="font-size: 15px;">存储</a> <a href="/tags/翻页/" style="font-size: 15px;">翻页</a> <a href="/tags/索引/" style="font-size: 15px;">索引</a> <a href="/tags/优化/" style="font-size: 15px;">优化</a> <a href="/tags/串口/" style="font-size: 15px;">串口</a> <a href="/tags/PCI/" style="font-size: 15px;">PCI</a> <a href="/tags/QT/" style="font-size: 15px;">QT</a> <a href="/tags/raft/" style="font-size: 15px;">raft</a> <a href="/tags/OpenSSL/" style="font-size: 15px;">OpenSSL</a> <a href="/tags/RSA加密解密/" style="font-size: 15px;">RSA加密解密</a> <a href="/tags/SECS-GEM-Go/" style="font-size: 15px;">SECS/GEM - Go</a> <a href="/tags/SECS-GEM/" style="font-size: 15px;">SECS/GEM</a> <a href="/tags/UDP/" style="font-size: 15px;">UDP</a> <a href="/tags/TCP/" style="font-size: 15px;">TCP</a> <a href="/tags/GFS/" style="font-size: 15px;">GFS</a> <a href="/tags/The-Google-File-System/" style="font-size: 15px;">The Google File System</a> <a href="/tags/ARM/" style="font-size: 15px;">ARM</a> <a href="/tags/Tiny6410/" style="font-size: 15px;">Tiny6410</a> <a href="/tags/yapi/" style="font-size: 15px;">yapi</a> <a href="/tags/资料/" style="font-size: 15px;">资料</a> <a href="/tags/bufio/" style="font-size: 15px;">bufio</a> <a href="/tags/ReadLine-ReadBytes/" style="font-size: 15px;">ReadLine - ReadBytes</a> <a href="/tags/缓存/" style="font-size: 15px;">缓存</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最近文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2024/08/18/桌面客户端Golang-Wails快速开发/">桌面客户端Golang-Wails快速开发</a></li><li class="post-list-item"><a class="post-list-link" href="/2023/11/15/SECS-GEM-Golang解包、封包库/">SECS/GEM-Golang解包、封包库</a></li><li class="post-list-item"><a class="post-list-link" href="/2023/05/18/Go语言实现HTTP到gRPC请求转换的最简单方法/">Go语言实现HTTP到gRPC请求转换的最简单方法</a></li><li class="post-list-item"><a class="post-list-link" href="/2023/04/01/自动mock-grpc服务/">自动mock grpc服务</a></li><li class="post-list-item"><a class="post-list-link" href="/2023/02/22/SECS-GEM协议学习/">SECS/GEM协议学习</a></li><li class="post-list-item"><a class="post-list-link" href="/2022/10/27/Golang-oracle使用/">Golang oracle使用</a></li><li class="post-list-item"><a class="post-list-link" href="/2022/07/21/Yapi的安装以及使用/">Yapi的安装以及使用</a></li><li class="post-list-item"><a class="post-list-link" href="/2022/06/24/MySQL-实战45讲-学习笔记/">MySQL 实战45讲 学习笔记</a></li><li class="post-list-item"><a class="post-list-link" href="/2022/06/16/go-kratos写代码浅记/">go-kratos写代码浅记</a></li><li class="post-list-item"><a class="post-list-link" href="/2022/05/09/proto管理之submodule/">proto管理之submodule</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="https://purelife.gitbook.io/little-design-powerpoint/" title="PowerPoint设计小册" target="_blank">PowerPoint设计小册</a><ul></ul><a href="https://masuit.com" title="懒得勤快的博客" target="_blank">懒得勤快的博客</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2024 <a href="/." rel="nofollow">Pure Life.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=1.0.0" async></script><script type="text/javascript" src="//cdn.jsdelivr.net/gh/fancyapps/fancybox/dist/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=1.0.0" async></script><link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox/dist/jquery.fancybox.min.css"><script type="text/javascript" src="/js/copycode.js" successtext="复制成功!"></script><link rel="stylesheet" type="text/css" href="/css/copycode.css"><script type="text/javascript" src="/js/codeblock-resizer.js?v=1.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=1.0.0"></script></div></body></html>